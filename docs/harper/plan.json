{
  "reqs": [
    {
      "id": "REQ-001",
      "title": "PostgreSQL Schema Definition",
      "acceptance": [
        "Schema creates all tables",
        "Indexes on foreign keys exist",
        "ENUM types defined correctly",
        "Timestamps default to NOW()",
        "UUIDs use gen_random_uuid()"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-002",
      "title": "Database Connection Pool",
      "acceptance": [
        "Pool initializes with max 20 connections",
        "Connection timeout set to 5s",
        "Health check query executes on startup",
        "Graceful shutdown closes all connections",
        "Metrics expose active/idle connection counts"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-003",
      "title": "Vault Secrets Client",
      "acceptance": [
        "Client authenticates via Kubernetes service account",
        "Fetches Slack signing secret successfully",
        "Fetches PostgreSQL credentials successfully",
        "Caches secrets for 5 minutes",
        "Retries with exponential backoff on failure"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-004",
      "title": "Slack Signature Verification Middleware",
      "acceptance": [
        "Middleware validates X-Slack-Signature header",
        "Rejects requests with invalid signatures (401)",
        "Rejects requests older than 5 minutes (401)",
        "Logs verification failures to Prometheus",
        "Passes valid requests to handler"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-005",
      "title": "Slack Command Handler \u2014 /coffee",
      "acceptance": [
        "Responds within 2 seconds with modal payload",
        "Modal includes drink_type dropdown (5 options)",
        "Modal includes size radio buttons (3 options)",
        "Modal includes customizations text input",
        "Returns HTTP 200 with application/json"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-006",
      "title": "Slack Interaction Handler \u2014 Order Submission",
      "acceptance": [
        "Parses modal submission payload",
        "Creates CoffeeRun record if first order",
        "Inserts Order record with user_id and run_id",
        "Publishes coffee.order.placed event to Kafka",
        "Returns HTTP 200 with thread update message"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-007",
      "title": "Kafka Producer \u2014 Event Publishing",
      "acceptance": [
        "Producer initializes with 3 partition topic",
        "Publishes events with user_id as partition key",
        "Confirms delivery with acks=all",
        "Retries up to 3 times on failure",
        "Logs publish failures to Prometheus"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-008",
      "title": "Runner Assignment Algorithm",
      "acceptance": [
        "Queries last 30 days of runs per user",
        "Excludes users with no orders in 14 days",
        "Selects user with minimum run count",
        "Breaks ties by earliest last_run timestamp",
        "Updates CoffeeRun.runner_user_id atomically"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-009",
      "title": "Kafka Consumer \u2014 Runner Assignment Trigger",
      "acceptance": [
        "Consumes coffee.order.placed events",
        "Triggers assignment after 5-minute window or 5 orders",
        "Calls runner assignment algorithm",
        "Publishes coffee.runner.assigned event",
        "Commits offset after successful processing"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-010",
      "title": "Slack Messaging Client \u2014 DM Sender",
      "acceptance": [
        "Sends DM via chat.postMessage API",
        "Includes order summary with markdown formatting",
        "Attaches \"Mark Complete\" button with callback_id",
        "Retries with exponential backoff on HTTP 429",
        "Logs rate limit events to Prometheus"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-011",
      "title": "Reminder Scheduler \u2014 Runner Notification",
      "acceptance": [
        "Schedules reminder 5 minutes after assignment",
        "Fetches runner_user_id from CoffeeRun",
        "Calls Slack DM sender with reminder message",
        "Updates reminder_sent_at timestamp",
        "Handles cancellation if run completed early"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-012",
      "title": "Slack Interaction Handler \u2014 Mark Complete",
      "acceptance": [
        "Parses button click payload",
        "Validates runner_user_id matches clicker",
        "Updates CoffeeRun status to completed",
        "Publishes coffee.run.completed event",
        "Posts completion message in thread"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-013",
      "title": "User Preferences \u2014 Storage and Retrieval",
      "acceptance": [
        "Inserts/updates UserPreference on order placement",
        "Increments order_count for matching preferences",
        "Retrieves top 3 preferences by order_count",
        "Returns preferences sorted by last_ordered_at",
        "Handles missing preferences gracefully"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-014",
      "title": "Slack Command Handler \u2014 /coffee-history",
      "acceptance": [
        "Queries last 10 CoffeeRun records for user",
        "Joins with Order to get order counts",
        "Formats response with timestamps and runner names",
        "Returns HTTP 200 within 2 seconds",
        "Handles empty history with friendly message"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-015",
      "title": "Slack Command Handler \u2014 /coffee-cancel",
      "acceptance": [
        "Validates user is initiator or runner",
        "Updates CoffeeRun status to cancelled",
        "Publishes coffee.run.cancelled event",
        "Posts cancellation message in thread",
        "Returns HTTP 403 if unauthorized"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-016",
      "title": "Audit Logging \u2014 Event Persistence",
      "acceptance": [
        "Inserts AuditLog record for each event type",
        "Stores event_type",
        "user_id",
        "run_id",
        "payload",
        "Payload serialized as JSONB",
        "Timestamp defaults to NOW()",
        "Retention policy enforced via cron job (90 days)"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-017",
      "title": "Prometheus Metrics Instrumentation",
      "acceptance": [
        "Exposes /metrics endpoint with histogram for command latency",
        "Counter for order placements by drink_type",
        "Gauge for active runs",
        "Counter for runner assignments",
        "Counter for errors by type"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    },
    {
      "id": "REQ-018",
      "title": "Circuit Breaker \u2014 PostgreSQL Resilience",
      "acceptance": [
        "Opens after 5 consecutive connection failures",
        "Half-opens after 30 seconds",
        "Returns HTTP 503 during open state",
        "Logs state transitions to Prometheus",
        "Recovers automatically when database available"
      ],
      "dependsOn": [],
      "track": "App",
      "status": "open"
    }
  ],
  "snapshot": {
    "total": 18,
    "open": 18,
    "in_progress": 0,
    "done": 0,
    "deferred": 0,
    "progressPct": 0
  }
}